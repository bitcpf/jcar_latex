\section{Mixed Multiband Multihop Path and Solutions}
\label{sec:algorithms}


In this section, we discuss the influence of ~\emph{Multiband} on ~\emph{Multihop Path} in mesh network. 
Accodirng to these analysis, we develop two algorithms for ~\emph{Multiband Channel Assignment}.

% PEN part 
\input{networkefficiency}


The previous discussion provide a way to evaluate different path. But the difficulty of channel assignment is that before the channel assignment has been done, we could not get a final conflict matrix, and we can not evaluate each path accurate.
Since could not describe how the traffic flow will be assigned, we try to improve the $Minimum\ Path Efficiency over Network$ with at least one connection to the gateway for each mesh node.
To approach the solution, we propose two local search based algorithms to adapt the multiband scenario. 


\subsection{Hop by Hop Tree Grow Algorithm}
To improve efficiency of a path, one way is to reduce the hop count, another way is to reduce the conflict link counts.
In a mesh network, gateway nodes always building in the most busy location ~\cite{robinson2008adding, he2008optimizing}.
As the service tree rooted at a gateway grows, the links closer to the gateway, the more interference will happen.
So a rule to reduce interference is to distribute the links to different channels. Typically a mesh network will be less populated near its edge, in these cases, reduce hop count through lower frequency may bring more benefit. 
Then a second rule will be use higher freq first at the beginning of the service tree growing. The degree in ~\cite{he2008optimizing} is taken to evaluate the potential connectivity of a mesh node. 
The mesh node with less degree will be served first since they may not have other options for connection.
~\cite{ramachandran2006interference} has similar process, but their work focus on multichannel scenario without considering topology difference among bands.
   % Analyze the complexity of the algorithms, need to know about the two proposed algorithms

   We develop the ~\emph{Hop by Hop Tree Grow} algorithm as shown in ~\ref{algorithms:hoho}.


% Need to talk about how to improve the bottle neck links,
%FIXME talk about BFS-CA 





\begin{algorithm}
    \small
\caption{Multiband Hop by Hop Tree Grow Algorithm}
\label{algorithms:hoho}
\begin{algorithmic}[1]
\REQUIRE  ~~\\
	 $M$: The set of all mesh nodes\\
	 $G$: The set of gateway nodes\\
	 $C$: Communication graph of potential links among all nodes\\
	 $I$: Interference matrix of all potential links \\
	 $B$: Bands amount
\ENSURE ~~\\    
$CA$: Channel Assignment from Gateway nodes to Mesh nodes\\
\STATE Initial $S_{current}=G$, $N_{served}=\emptyset$, $N_{unserved}=M$,$I_{active}=\emptyset$
\STATE Generate 2 hop Adjacency Matrix $A$ from $C$
\FORALL {$s \in S_{current}$}
	\STATE Find one-hop nodes $S_{Next}$
	\STATE Sort $S_Next$ with connection degree, small degree first
	\FORALL {$l \in S_{Next}$}
		\STATE Calculate one-hop path efficiency from $s\rightarrow l$
		\STATE Sort each channel, high frequency first if have same PEN
		\STATE Assign(s,l) with the best channel to $OC$
		\STATE Update $N_{served},N_{unserved}$
		\STATE Update $I_{active}$ from $I$
	\ENDFOR
	\STATE $S_{current}=S_{Next}$
\ENDFOR
% Round 2, resolve bottle neck problem
% After above, all node has its shortest path, but exist bottle neck, at least have a connection
% If could add band, add band to the high occupacied channel
\STATE Initial $S_{current}=G$, $N_{served}=\emptyset$, $N_{unserved}=M$,$I_{active}=\emptyset$
\STATE Depth tranverse all gateway rooted tree, calculated child node amount as load weight $W_{i,l}$ for each node
\FORALL {$s \in S_{current}$}
	\STATE Find one-hop nodes $S_{Next}$
	\STATE Sort $S_Next$ with $W_i{i,l}$
	\STATE Calculate load degree $\sum_{i}W_{i,l}$ of $S_{Next}$, and the percent of each node in $S_{Next}$ 
	\STATE Let $N_{current}$ be the node with highest load weight
	\STATE Find all links from high load tree to low weight load tree as $TL_{potential}$, denote the nodes of the links in the high load tree as $N_{high\ load}$
	\STATE Find the shortest path to all the node of the substree from $N_{high\ load}$, calculate the average hop count $H_{average}$, calculate their average interference as $\bar{I}$
	\STATE Mark each link in $TL_{potential}$ with $H_{average}$, plus the hop from the node on the link in low load tree to current subtree root
	\STATE Calculate their PEN with the average $\bar{I}$
	\STATE Compare the PEN with the PEN adding a channel assignment, then choose the maximum PEN to connect the high load tree and the low load tree
	\STATE Iterate to the subtree and connect them.
\ENDFOR


\STATE  Find valid close(s,T) \\
Output $Channel Assignment$ as Solution
\end{algorithmic}
\end{algorithm}
      

%FIXME need more explaination of the tree growing algorithm
The algorithm use the average $\bar{I}$ and average hop count to approach the channel assignment
In ~\cite{robinson2008adding}, Robinson talked about the bottle neck of a network is the links neighbor to the gateway nodes.





\subsection{Sink To End Path Algorithm}
\label{subsec:step}

Based on the previous path efficiency analyze, the network efficiency is related to each link's interference and the distance to gateway nodes. To find a path for each mesh node, which could be converge to a shortest weight path detect
We define weight for each link and improve Dijikstra's algorithm with ~\emph{PEN} weight to find the best path for each mesh node ~\cite{golden1976shortest}.
To run Dijikstra's algorithm, we define two parameter of each link between two nodes. First is the existing interference of the link $I_w$, we mark the interference of bands as multiple links. 
The second is the ~\emph{Load Weight} of a link $l_w$, which is the number of path chosen this link. In Dijikstra's algorithm, the weight is calculated as denominator of ~\emph{PEN}, since the numerator is the same among different bands.
This parameter used to adjust the ~\emph{PEN} with bottle neck links.
The weight of Dijikstra's algorithm is related to hop order $h_i$ according to the definition of ~\emph{PEN}, the weight is calculated as $I_w\times h_i \times \l_w$.
We iterately find the best path of each node and update the parameters in the graph.





\begin{algorithm}
    \small
\caption{Sink To End Path Algorithm}
\label{algorithms:step}
\begin{algorithmic}[1]
\REQUIRE  ~~\\
	$M$: The set of all mesh nodes\\
	$G$: The set of gateway nodes\\
	$C$: Communication graph of potential links among all nodes\\
	$I$: Interference matrix of all potential links \\
	$B$: Bands amount
\ENSURE ~~\\    
$CA$: Channel Assignment from Gateway nodes to Mesh nodes\\
\WHILE {$notAllnodesVisited(M)$}
\STATE Intialize $CA,I_w,l_w$\\
		\STATE Run Dijistra's Algorithm with $C,I,B$ to all the Gateways
		\STATE Compare the $PEN$ to all Gateway node
		\STATE Choose the best one adding to $CA$
		\STATE Update $I_w,l_w$
\STATE Calculate $\triangle cost$ for all valid operations\\
\STATE Apply $swap$ with largest positive $\triangle cost$
\ENDWHILE 

Output $CA$ as locally optimal solution\\
\end{algorithmic}
\end{algorithm}


